# U-Boot: pikvm

pkgbase=uboot-pikvm
pkgname=('uboot-pikvm-libretech-all-h3-cc-h2-plus'
		 'uboot-pikvm-libretech-all-h3-cc-h3'
		 'uboot-pikvm-orangepi-one'
		 'uboot-pikvm-orangepi-zero'
		 )
pkgver=2020.07
pkgrel=3
arch=('armv7h')
url="http://git.denx.de/u-boot.git/"
license=('GPL')
makedepends=('bc' 'git' 'python' 'swig' 'dtc' 'uboot-tools')
depends=('uboot-tools')
backup=(boot/boot.txt boot/boot.scr)
source=("ftp://ftp.denx.de/pub/u-boot/u-boot-${pkgver}.tar.bz2"
        'boot.txt.sunxi'
        'mkscr')
md5sums=(SKIP SKIP SKIP)

boards_sunxi=('libretech_all_h3_cc_h2_plus'
			'libretech_all_h3_cc_h3'
			'orangepi_one'
			'orangepi_zero'
			)
# nanopi_neo

build() {

  cd ${srcdir}/u-boot-${pkgver}
  unset CFLAGS CXXFLAGS LDFLAGS
  
  for i in ${boards_sunxi[@]}; do
    mkdir ../bin_${i}
    make clean
    make ${i}_defconfig
    echo 'CONFIG_IDENT_STRING=" Arch Linux ARM"' >> .config
    make EXTRAVERSION=-${pkgrel}
    mv u-boot-sunxi-with-spl.bin ../bin_${i}/u-boot.bin
  done

  tools/mkimage -A arm -O linux -T script -C none -n "U-Boot boot script" -d ../boot.txt.sunxi ../boot.scr.sunxi

}

package_uboot-pikvm-libretech-all-h3-cc-h2-plus() {
  pkgdesc="U-Boot for Libre Computer Board ALL-H3-CC"
  install=${pkgbase}.install

  install -d "${pkgdir}"/boot
  install -Dm644 bin_libretech_all_h3_cc_h2_plus/u-boot.bin "${pkgdir}"/boot

  install -Dm644 boot.txt.sunxi "${pkgdir}"/boot/boot.txt
  install -Dm644 boot.scr.sunxi "${pkgdir}"/boot/boot.scr
  install -Dm755 mkscr "${pkgdir}"/boot/mkscr
}

package_uboot-pikvm-libretech-all-h3-cc-h3() {
  pkgdesc="U-Boot for Libre Computer Board ALL-H3-CC"
  install=${pkgbase}.install

  install -d "${pkgdir}"/boot
  install -Dm644 bin_libretech_all_h3_cc_h3/u-boot.bin "${pkgdir}"/boot

  install -Dm644 boot.txt.sunxi "${pkgdir}"/boot/boot.txt
  install -Dm644 boot.scr.sunxi "${pkgdir}"/boot/boot.scr
  install -Dm755 mkscr "${pkgdir}"/boot/mkscr
}

package_uboot-pikvm-orangepi-one() {
  pkgdesc="U-Boot for Orange Pi One"
  install=${pkgbase}.install

  install -d "${pkgdir}"/boot
  install -Dm644 bin_orangepi_one/u-boot.bin "${pkgdir}"/boot

  install -Dm644 boot.txt.sunxi "${pkgdir}"/boot/boot.txt
  install -Dm644 boot.scr.sunxi "${pkgdir}"/boot/boot.scr
  install -Dm755 mkscr "${pkgdir}"/boot/mkscr
}

package_uboot-pikvm-orangepi-zero() {
  pkgdesc="U-Boot for Orange Pi Zero"
  install=${pkgbase}.install

  install -d "${pkgdir}"/boot
  install -Dm644 bin_orangepi_zero/u-boot.bin "${pkgdir}"/boot

  install -Dm644 boot.txt.sunxi "${pkgdir}"/boot/boot.txt
  install -Dm644 boot.scr.sunxi "${pkgdir}"/boot/boot.scr
  install -Dm755 mkscr "${pkgdir}"/boot/mkscr
}